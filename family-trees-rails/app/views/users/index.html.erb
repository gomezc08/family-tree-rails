<% content_for :title, "Family Tree Members" %>

<div class="container mt-4">
  <% if notice %>
    <div class="alert alert-success alert-dismissible fade show animate-fade-in-up" role="alert">
      <%= notice %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>

  <div class="page-header animate-fade-in-up">
    <div>
      <h1>Family Tree Members</h1>
      <p class="text-muted mb-0">Browse all members of your family tree</p>
    </div>
  </div>

  <% if @users.any? %>
    <div class="members-grid">
      <% @users.each do |user| %>
        <div class="family-member-card">
          <!-- Profile Image or Placeholder -->
          <% if user.picture.attached? %>
            <%= image_tag user.picture, class: "profile-image", alt: "#{user.first_name} #{user.last_name}" %>
          <% else %>
            <div class="placeholder-image">
              <%= (user.first_name.presence || user.email[0]).upcase[0] %>
            </div>
          <% end %>

          <!-- Member Name -->
          <div class="member-name">
            <%= "#{user.first_name} #{user.last_name}".strip.presence || user.email.split('@').first %>
            <% if user.date_died %>
              <span class="deceased-badge d-block mt-2">Deceased</span>
            <% end %>
          </div>

          <!-- Member Details -->
          <div class="member-details mt-3">
            <% if user.birthday %>
              <div class="mb-2">
                <strong>Born:</strong> <%= user.birthday.strftime("%B %d, %Y") %>
              </div>
              <div class="mb-2">
                <strong>Age:</strong>
                <% if user.date_died %>
                  <%= ((user.date_died - user.birthday) / 365.25).to_i %> years (at passing)
                <% else %>
                  <%= ((Date.today - user.birthday) / 365.25).to_i %> years
                <% end %>
              </div>
            <% end %>

            <% if user.citycurrent || user.statecurrent %>
              <div class="mb-2">
                <strong>Location:</strong>
                <%= [user.citycurrent, user.statecurrent].compact.join(', ').presence || "N/A" %>
              </div>
            <% end %>

            <% if user.email %>
              <div class="mb-2 text-truncate">
                <strong>Email:</strong>
                <small><%= user.email %></small>
              </div>
            <% end %>
          </div>

          <!-- Actions -->
          <div class="mt-auto pt-3">
            <%= link_to "View Profile", user, class: "btn btn-primary w-100" %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="empty-state animate-fade-in-up">
      <div class="empty-state-icon">ðŸ‘¥</div>
      <h3>No Family Members Yet</h3>
      <p>Start building your family tree by adding your first member.</p>
    </div>
  <% end %>
</div>
