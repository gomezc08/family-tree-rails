<div class="container mt-4">
  <div class="page-header animate-fade-in-up">
    <div>
      <h1>Family Relationships</h1>
      <p class="text-muted mb-0">Manage connections between family members</p>
    </div>
    <div class="page-header-actions">
      <% pending_count = Relationship.where(relative_id: current_user.id, status: 'pending').where.not(initiated_by_id: current_user.id).count %>
      <%= link_to pending_relationships_path, class: "btn btn-warning position-relative me-2" do %>
        Pending Requests
        <% if pending_count > 0 %>
          <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
            <%= pending_count %>
          </span>
        <% end %>
      <% end %>
      <%= link_to new_relationship_path, class: "btn btn-success" do %>
        Add New Relationship
      <% end %>
    </div>
  </div>

  <!-- Sent Pending Requests (waiting for others to approve) -->
  <% if @sent_pending.any? %>
    <div class="card animate-fade-in-up mb-4">
      <div class="card-header bg-warning bg-opacity-10">
        <h5 class="mb-0">
          <i class="bi bi-hourglass-split me-2"></i>
          Pending Requests You Sent
        </h5>
        <p class="text-muted mb-0 small">Waiting for the other person to approve these requests</p>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>Requested Relationship</th>
                <th>With</th>
                <th>Sent On</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @sent_pending.each do |relationship| %>
                <tr>
                  <td>
                    <span class="badge bg-info">
                      <%= relationship.display_type %>
                    </span>
                  </td>
                  <td>
                    <%= link_to relationship.relative.display_name, relationship.relative, class: "text-primary-custom fw-semibold" %>
                  </td>
                  <td>
                    <%= relationship.created_at.strftime("%b %d, %Y") %>
                  </td>
                  <td>
                    <span class="badge bg-warning">Waiting for approval</span>
                  </td>
                  <td>
                    <%= button_to "Cancel Request", relationship_path(relationship),
                        method: :delete,
                        data: { turbo_confirm: "Are you sure you want to cancel this request?" },
                        class: "btn btn-sm btn-outline-danger" %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Approved Relationships -->
  <% if @relationships.any? %>
    <div class="card animate-fade-in-up">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="bi bi-check-circle me-2"></i>
          Approved Relationships
        </h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Person 1</th>
                <th>Relationship</th>
                <th>Person 2</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @relationships.each do |relationship| %>
                <tr>
                  <td>
                    <%= link_to relationship.user.display_name, relationship.user, class: "text-primary-custom fw-semibold" %>
                  </td>
                  <td>
                    <span class="badge bg-info">
                      <%= relationship.display_type %>
                    </span>
                  </td>
                  <td>
                    <%= link_to relationship.relative.display_name, relationship.relative, class: "text-primary-custom fw-semibold" %>
                  </td>
                  <td>
                    <%= relationship.start_date&.strftime("%b %d, %Y") || "-" %>
                  </td>
                  <td>
                    <%= relationship.end_date&.strftime("%b %d, %Y") || "-" %>
                  </td>
                  <td>
                    <% if relationship.approved? %>
                      <% if relationship.active? %>
                        <span class="badge bg-success">Active</span>
                      <% else %>
                        <span class="badge bg-secondary">Ended</span>
                      <% end %>
                    <% elsif relationship.pending? %>
                      <span class="badge bg-warning">Pending Approval</span>
                    <% elsif relationship.rejected? %>
                      <span class="badge bg-danger">Rejected</span>
                    <% end %>
                  </td>
                  <td>
                    <div class="d-flex gap-2">
                      <%= link_to "Edit", edit_relationship_path(relationship), class: "btn btn-sm btn-outline-primary" %>
                      <%= button_to "Delete", relationship_path(relationship),
                          method: :delete,
                          data: { turbo_confirm: "Are you sure you want to delete this relationship?" },
                          class: "btn btn-sm btn-outline-danger" %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="mt-4 animate-fade-in-up">
      <%= link_to family_tree_path, class: "btn btn-success" do %>
        View Family Tree
      <% end %>
    </div>
  <% else %>
    <div class="empty-state animate-fade-in-up">
      <div class="empty-state-icon">ðŸ”—</div>
      <h3>No Relationships Found</h3>
      <p>You haven't added any family relationships yet. Start connecting your family members!</p>
      <%= link_to "Add Your First Relationship", new_relationship_path, class: "btn btn-success btn-lg" %>
    </div>
  <% end %>
</div>
